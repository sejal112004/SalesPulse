{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Upload Data - SalesPulse</title>

    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

    <!-- Custom Theme (if you have global styles) -->
    <link rel="stylesheet" href="{% static 'css/salespulse-theme.css' %}">

    <!-- Page-specific CSS -->
    <link rel="stylesheet" href="{% static 'css/upload.css' %}">

    <!-- Favicon -->
    <link rel="icon" href="{% static 'images/logo/salespulse-icon-32.png' %}">
</head>

<body class="text-white">

    {% include 'includes/navbar.html' %}

    <div class="upload-page-container">
        <!-- Messages -->
        {% if messages %}
        <div class="messages-container">
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <div class="upload-layout">
            <!-- Top Row: Upload Section -->
            <div class="upload-section-wrapper">
                <h2 class="section-title-main">
                    <i class="bi bi-cloud-upload-fill"></i>
                    Upload Sales Data
                </h2>
                <form method="post" enctype="multipart/form-data" class="upload-form-simple">
                    {% csrf_token %}
                    <input type="file" name="sales_file" class="file-input-simple" accept=".csv,.xlsx,.xls" multiple
                        required>
                    <small class="file-hint-text">
                        Up to 3 files (Max 50MB each)
                    </small>
                    <button type="submit" class="btn-upload-simple">
                        <i class="bi bi-cloud-upload me-2"></i>
                        Upload & Analyze
                    </button>
                </form>
                {% if active_filename and active_filename != 'No file uploaded' %}
                <div class="active-indicator">
                    <i class="bi bi-check-circle-fill"></i>
                    <span>Active: {{ active_filename|truncatechars:30 }}</span>
                    <span class="dash-separator">-</span>
                    <a href="{% url 'analyzer:dashboard' %}" class="dashboard-link-text">Dashboard</a>
                </div>
                {% endif %}
            </div>

            <!-- Bottom Row: Datasets List -->
            <div class="datasets-section-wrapper">
                <div class="datasets-title-row">
                    <h2 class="section-title-main">
                        <i class="bi bi-folder-fill"></i>
                        Your Datasets
                    </h2>
                    <span class="files-count-text">
                        Up to 3 Active Files
                    </span>
                </div>

                {% if datasets %}
                <div class="datasets-list-container">
                    {% for dataset in datasets %}
                    <div class="dataset-list-item {% if dataset.id == active_dataset_id %}is-active{% endif %}">
                        <div class="dataset-main-info">
                            <div class="dataset-name-row">
                                <i class="bi bi-file-earmark-spreadsheet-fill dataset-icon"></i>
                                <span class="dataset-name-text">{{ dataset.name }}</span>
                            </div>
                            <div class="dataset-meta-row">
                                <span class="dataset-date-text">{{ dataset.uploaded_at|date:"M d, Y H:i" }}</span>
                                {% if dataset.id == active_dataset_id %}
                                <span class="status-active">
                                    <i class="bi bi-check-circle-fill"></i> Active
                                </span>
                                {% else %}
                                <span class="status-inactive">
                                    <i class="bi bi-circle"></i> Inactive
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="dataset-actions-row">
                            {% if dataset.id != active_dataset_id %}
                            <form method="post" action="{% url 'analyzer:activate_dataset' dataset.id %}"
                                style="display: inline;">
                                {% csrf_token %}
                                <input type="hidden" name="activate_dataset" value="1">
                                <button type="submit" class="action-btn action-activate" title="Activate">
                                    <i class="bi bi-arrow-clockwise"></i>
                                </button>
                            </form>
                            {% else %}
                            <a href="{% url 'analyzer:dashboard' %}" class="action-btn action-dashboard"
                                title="View Dashboard">
                                <i class="bi bi-speedometer2"></i>
                            </a>
                            {% endif %}

                            <!-- View Dataset Button -->
                            <a href="{% url 'analyzer:view_dataset' dataset.id %}" class="action-btn action-view"
                                title="View Data" style="color: #6c757d;">
                                <i class="bi bi-eye-fill"></i>
                            </a>

                            <a href="{{ dataset.file.url }}" target="_blank" class="action-btn action-download"
                                title="Download">
                                <i class="bi bi-download"></i>
                            </a>
                            <form method="post" action="{% url 'analyzer:delete_dataset' dataset.id %}"
                                style="display: inline;" onsubmit="return confirm('Delete {{ dataset.name }}?');">
                                {% csrf_token %}
                                <button type="submit" class="action-btn action-delete" title="Delete">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="bi bi-inbox"></i>
                    <p>No datasets uploaded yet</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>

</html>